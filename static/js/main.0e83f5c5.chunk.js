(this.webpackJsonppaint=this.webpackJsonppaint||[]).push([[0],{47:function(t,e,n){},48:function(t,e,n){},50:function(t,e,n){},52:function(t,e,n){},79:function(t,e,n){"use strict";n.r(e);var s=n(0),i=n.n(s),a=n(16),o=n.n(a),c=(n(47),n(48),n(8)),r=n(9),h=n(5),u=new(function(){function t(){Object(c.a)(this,t),this.tool=null,Object(h.d)(this)}return Object(r.a)(t,[{key:"setTool",value:function(t){this.tool=t}},{key:"setFillColor",value:function(t){this.tool.fillColor=t}},{key:"setStrokeColor",value:function(t){this.tool.strokeColor=t}},{key:"setLineWidth",value:function(t){this.tool.lineWidth=t}}]),t}()),l=n(1),d=function(){return Object(l.jsxs)("div",{className:"setting-bar",children:[Object(l.jsx)("label",{htmlFor:"line-width",children:"\u0422\u043e\u043b\u0449\u0438\u043d\u0430 \u043b\u0438\u043d\u0438\u0438"}),Object(l.jsx)("input",{onChange:function(t){return u.setLineWidth(t.target.value)},style:{margin:"0 10px"},id:"line-width",type:"number",defaultValue:1,min:1,max:50}),Object(l.jsx)("label",{htmlFor:"stroke-color",children:"\u0426\u0432\u0435\u0442 \u043e\u0431\u0432\u043e\u0434\u043a\u0438"}),Object(l.jsx)("input",{onChange:function(t){return u.setStrokeColor(t.target.value)},id:"stroke-color",type:"color"})]})},f=(n(50),n(19)),v=n(18),b=function(){function t(e,n,s){Object(c.a)(this,t),this.canvas=e,this.socket=n,this.id=s,this.ctx=e.getContext("2d"),this.destroyEvents()}return Object(r.a)(t,[{key:"fillColor",set:function(t){this.ctx.fillStyle=t}},{key:"strokeColor",set:function(t){this.ctx.strokeStyle=t}},{key:"lineWidth",set:function(t){this.ctx.lineWidth=t}},{key:"destroyEvents",value:function(){this.canvas.onmousemove=null,this.canvas.onmousedown=null,this.canvas.onmouseup=null}}]),t}(),m=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t,s,i){var a;return Object(c.a)(this,n),(a=e.call(this,t,s,i)).listen(),a}return Object(r.a)(n,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"finish"}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"brush",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop}}))}}],[{key:"draw",value:function(t,e,n){t.lineTo(e,n),t.stroke()}}]),n}(b),g=new(function(){function t(){Object(c.a)(this,t),this.canvas=null,this.socket=null,this.sessionid=null,this.undoList=[],this.redoList=[],this.username="",Object(h.d)(this)}return Object(r.a)(t,[{key:"setSessionId",value:function(t){this.sessionid=t}},{key:"setSocket",value:function(t){this.socket=t}},{key:"setUsername",value:function(t){this.username=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"pushToUndo",value:function(t){this.undoList.push(t)}},{key:"pushToRedo",value:function(t){this.redoList.push(t)}},{key:"undo",value:function(){var t=this,e=this.canvas.getContext("2d");if(this.undoList.length>0){var n=this.undoList.pop();this.redoList.push(this.canvas.toDataURL());var s=new Image;s.src=n,s.onload=function(){e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(s,0,0,t.canvas.width,t.canvas.height)}}else e.clearRect(0,0,this.canvas.width,this.canvas.heigth)}},{key:"redo",value:function(){var t=this,e=this.canvas.getContext("2d");if(this.redoList.length>0){var n=this.redoList.pop();this.undoList.push(this.canvas.toDataURL());var s=new Image;s.src=n,s.onload=function(){e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(s,0,0,t.canvas.width,t.canvas.height)}}}}]),t}()),j=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t,s,i){var a;return Object(c.a)(this,n),(a=e.call(this,t,s,i)).listen(),a}return Object(r.a)(n,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"rect",x:this.startX,y:this.startY,width:this.width,height:this.height,color:this.ctx.fillStyle}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,n=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=n-this.startY,this.draw(this.startX,this.startY,this.width,this.height)}}},{key:"draw",value:function(t,e,n,s){var i=this,a=new Image;a.src=this.saved,a.onload=function(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.ctx.drawImage(a,0,0,i.canvas.width,i.canvas.height),i.ctx.beginPath(),i.ctx.rect(t,e,n,s),i.ctx.fill(),i.ctx.stroke()}}}],[{key:"staticDraw",value:function(t,e,n,s,i,a){t.fillStyle=a,t.beginPath(),t.rect(e,n,s,i),t.fill(),t.stroke()}}]),n}(b),w=n(21),p=n.n(w),k=n(22),x=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this,t)).listen(),s.name="Line",s}return Object(r.a)(n,[{key:"listen",value:function(){this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this),this.canvas.onmousemove=this.mouseMoveHandler.bind(this)}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.currentX=t.pageX-t.target.offsetLeft,this.currentY=t.pageY-t.target.offsetTop,this.ctx.beginPath(),this.ctx.moveTo(this.currentX,this.currentY),this.saved=this.canvas.toDataURL()}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.draw(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"draw",value:function(t,e){var n=new Image;n.src=this.saved,n.onload=Object(k.a)(p.a.mark((function s(){return p.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(n,0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.moveTo(this.currentX,this.currentY),this.ctx.lineTo(t,e),this.ctx.stroke();case 6:case"end":return s.stop()}}),s,this)}))).bind(this)}}]),n}(b),O=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this,t)).listen(),s}return Object(r.a)(n,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0;var e=this.canvas.toDataURL();this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=e}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,n=t.pageY-t.target.offsetTop,s=e-this.startX,i=n-this.startY,a=Math.sqrt(Math.pow(s,2)+Math.pow(i,2));this.draw(this.startX,this.startY,a)}}},{key:"draw",value:function(t,e,n){var s=new Image;s.src=this.saved,s.onload=Object(k.a)(p.a.mark((function i(){return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(s,0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.arc(t,e,n,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke();case 6:case"end":return i.stop()}}),i,this)}))).bind(this)}}]),n}(b),y=function(t){Object(f.a)(n,t);var e=Object(v.a)(n);function n(t){return Object(c.a)(this,n),e.call(this,t)}return Object(r.a)(n,[{key:"draw",value:function(t,e){this.ctx.strokeStyle="white",this.ctx.lineTo(t,e),this.ctx.stroke()}}]),n}(m),C=function(){return Object(l.jsxs)("div",{className:"toolbar",children:[Object(l.jsx)("button",{className:"toolbar__btn brush",onClick:function(){return u.setTool(new m(g.canvas,g.socket,g.sessionid))}}),Object(l.jsx)("button",{className:"toolbar__btn rect",onClick:function(){return u.setTool(new j(g.canvas,g.socket,g.sessionid))}}),Object(l.jsx)("button",{className:"toolbar__btn circle",onClick:function(){return u.setTool(new O(g.canvas))}}),Object(l.jsx)("button",{className:"toolbar__btn eraser",onClick:function(){return u.setTool(new y(g.canvas))}}),Object(l.jsx)("button",{className:"toolbar__btn line",onClick:function(){return u.setTool(new x(g.canvas))}}),Object(l.jsx)("input",{onChange:function(t){return function(t){u.setStrokeColor(t.target.value),u.setFillColor(t.target.value)}(t)},style:{marginLeft:10},type:"color"}),Object(l.jsx)("button",{className:"toolbar__btn undo",onClick:function(){return g.undo()}}),Object(l.jsx)("button",{className:"toolbar__btn redo",onClick:function(){return g.redo()}}),Object(l.jsx)("button",{className:"toolbar__btn save",onClick:function(){return function(){var t=g.canvas.toDataURL();console.log(t);var e=document.createElement("a");e.href=t,e.download=g.sessionid+".jpg",document.body.appendChild(e),e.click(),document.body.removeChild(e)}()}})]})},D=n(42),L=(n(52),n(41)),T=n(82),H=n(83),S=n(4),U=n(27),R=n.n(U),X=Object(L.a)((function(){var t=Object(s.useRef)(),e=Object(s.useRef)(),n=Object(s.useState)(!0),i=Object(D.a)(n,2),a=i[0],o=i[1],c=Object(S.g)();Object(s.useEffect)((function(){g.setCanvas(t.current);var e=t.current.getContext("2d");R.a.get("http://localhost:5000/image?id=".concat(c.id)).then((function(n){var s=new Image;s.src=n.data,s.onload=function(){e.clearRect(0,0,t.current.width,t.current.height),e.drawImage(s,0,0,t.current.width,t.current.height)}}))}),[]),Object(s.useEffect)((function(){if(g.username){var e=new WebSocket("ws://localhost:5000/");g.setSocket(e),g.setSessionId(c.id),u.setTool(new m(t.current,e,c.id)),e.onopen=function(){console.log("\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e"),e.send(JSON.stringify({id:c.id,username:g.username,method:"connection"}))},e.onmessage=function(t){var e=JSON.parse(t.data);switch(e.method){case"connection":console.log("\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c ".concat(e.username," \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u043b\u0441\u044f"));break;case"draw":r(e)}}}}),[g.username]);var r=function(e){var n=e.figure,s=t.current.getContext("2d");switch(n.type){case"brush":m.draw(s,n.x,n.y);break;case"rect":j.staticDraw(s,n.x,n.y,n.width,n.height,n.color);break;case"finish":s.beginPath()}};return Object(l.jsxs)("div",{className:"canvas",children:[Object(l.jsxs)(T.a,{show:a,onHide:function(){},children:[Object(l.jsx)(T.a.Header,{children:Object(l.jsx)(T.a.Title,{children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f"})}),Object(l.jsx)(T.a.Body,{children:Object(l.jsx)("input",{type:"text",ref:e})}),Object(l.jsx)(T.a.Footer,{children:Object(l.jsx)(H.a,{variant:"secondary",onClick:function(){return g.setUsername(e.current.value),void o(!1)},children:"\u0412\u043e\u0439\u0442\u0438"})})]}),Object(l.jsx)("canvas",{onMouseDown:function(){return g.pushToUndo(t.current.toDataURL()),void R.a.post("http://localhost:5000/image?id=".concat(c.id),{img:t.current.toDataURL()}).then((function(t){return console.log(t.data)}))},ref:t,width:600,height:400})]})})),Y=n(26),I=function(){return Object(l.jsx)(Y.a,{children:Object(l.jsx)("div",{className:"app",children:Object(l.jsxs)(S.d,{children:[Object(l.jsxs)(S.b,{path:"/:id",children:[Object(l.jsx)(C,{}),Object(l.jsx)(d,{}),Object(l.jsx)(X,{})]}),Object(l.jsx)(S.a,{to:"f".concat((+new Date).toString(16))})]})})})},N=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,84)).then((function(e){var n=e.getCLS,s=e.getFID,i=e.getFCP,a=e.getLCP,o=e.getTTFB;n(t),s(t),i(t),a(t),o(t)}))};o.a.render(Object(l.jsx)(i.a.StrictMode,{children:Object(l.jsx)(I,{})}),document.getElementById("root")),N()}},[[79,1,2]]]);
//# sourceMappingURL=main.0e83f5c5.chunk.js.map